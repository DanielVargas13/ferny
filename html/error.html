<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Connection failed</title>
    <link rel="shortcut icon" type="image/png" href="../imgs/icons16/disconnect.png"/>
    <link rel="stylesheet" href="../css/error.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  </head>
  <body>
    <center>
      <div class="block-title show">
        <img name="fire" class="theme-icon">
        <label>Error</label>
      </div>

      <div class="container">
        <div class="block-title show">
          <img name="disconnect" class="theme-icon">
          <label>Connection failed</label>
        </div>
        <label class="nav-label">This site can't be reached</label><br>
        <div class="nav-btn blue" onclick="reload()">
          <img class="theme-icon" name="refresh">
          <label>Reload</label>
        </div>
        <div class="nav-btn" onclick="goBack()">
          <img class="theme-icon" name="undo">
          <label>Go back</label>
        </div>
      </div>
    </center>
    <script type="text/javascript">
      const { ipcRenderer } = require('electron');

      function goBack() {
        ipcRenderer.send('request-tab-goback');
      }

      function reload() {
        ipcRenderer.send('request-tab-reload');
      }

      function changeTheme(color) {
        document.body.style.backgroundColor = color;

        if(checkIfDark(color)) {
          setIconsStyle('light');

          document.documentElement.style.setProperty('--color-top', 'white');
          document.documentElement.style.setProperty('--color-top-overlight', 'rgba(255, 255, 255, 0.1)');

          document.documentElement.style.setProperty('--color-back', 'black');
          document.documentElement.style.setProperty('--color-back-overlight', 'rgba(0, 0, 0, 0.1)');
        } else {
          setIconsStyle('dark');

          document.documentElement.style.setProperty('--color-top', 'black');
          document.documentElement.style.setProperty('--color-top-overlight', 'rgba(0, 0, 0, 0.1)');

          document.documentElement.style.setProperty('--color-back', 'white');
          document.documentElement.style.setProperty('--color-back-overlight', 'rgba(255, 255, 255, 0.1)');
        }
      }

      function setIconsStyle(str) {
        var icons = document.getElementsByClassName('theme-icon');

        for(var i = 0; i < icons.length; i++) {
          icons[i].src = "../themes/" + str + "/icons/" + icons[i].name + ".png";
        }
      }

      function checkIfDark(color) {
          var r, g, b, hsp;
          if (String(color).match(/^rgb/)) {
              color = String(color).match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/);

              r = color[1];
              g = color[2];
              b = color[3];
          } else {
              color = +("0x" + color.slice(1).replace(
              color.length < 5 && /./g, '$&$&'));

              r = color >> 16;
              g = color >> 8 & 255;
              b = color & 255;
          }

          hsp = Math.sqrt(0.299 * (r * r) + 0.587 * (g * g) + 0.114 * (b * b));

          if (hsp > 127.5) {
              return false;
          } else {
              return true;
          }
      }

      function loadTheme() {
        var fs = require("fs");
        var ppath = require('persist-path')('ArrowBrowser');

        try {
          var themeColor = fs.readFileSync(ppath + "\\json\\theme.json");
          changeTheme(themeColor);
        } catch (e) {

        }
      }

      function changeBorderRadius(size) {
        document.documentElement.style.setProperty('--px-radius', size + 'px');
      }

      function loadBorderRadius() {
        var fs = require("fs");
        var ppath = require('persist-path')('ArrowBrowser');

        try {
          var borderRadius = fs.readFileSync(ppath + "\\json\\radius.json");
          changeBorderRadius(borderRadius);

          var radios = document.getElementsByName("border-radius");
          for(var i = 0; i < radios.length; i++) {
            if(radios[i].value == borderRadius) {
              radios[i].checked = true;
            }
          }
        } catch (e) {

        }
      }

/*
          ██ ███    ██ ██ ████████
          ██ ████   ██ ██    ██
          ██ ██ ██  ██ ██    ██
          ██ ██  ██ ██ ██    ██
          ██ ██   ████ ██    ██
*/

      function init() {
        loadTheme();
        loadBorderRadius();
      }

      document.onreadystatechange =  () => {
        if (document.readyState == "complete") {
          init();
        }
      };
    </script>
  </body>
</html>
