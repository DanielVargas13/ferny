<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>About</title>
    <link rel="shortcut icon" type="image/png" href="../imgs/icons16/about.png"/>
    <link rel="stylesheet" href="../css/about.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  </head>
  <body>
    <center>
      <div class="block-title show">
        <img name="about" class="theme-icon">
        <label>About</label>
      </div>

      <div class="container">
        <img class="about-icon" src="../imgs/icon128.png" onclick="openAppPage()" title="App page"><br>
        <label class="nav-label">Arrow Browser</label><br>
        <label class="nav-label" id="about-app"></label><br>
        <div class="nav-btn" onclick="checkForUpdates()" title="Check for new version">
          <img class="nav-btn-icon theme-icon" name="check-updates">
          <label class="nav-btn-label">Check for updates</label>
        </div>
        <div class="nav-btn" onclick="openReleasesPage()" title="GitHub page">
          <img class="nav-btn-icon theme-icon" name="download">
          <label class="nav-btn-label">Releases</label>
        </div>

        <hr>

        <label class="nav-label">Created by:</label><br>
        <div class="nav-btn" onclick="openDeveloperPage()" title="Developer page">
          <img class="nav-btn-icon theme-icon" name="developer">
          <label class="nav-btn-label">Module Art</label>
        </div>

        <hr>

        <img name="atom" class="theme-icon"><label id="about-electron"></label><br>
        <img name="chrome" class="theme-icon"><label id="about-chrome"></label><br>
        <img name="node" class="theme-icon"><label id="about-node"></label>
      </div>
    </center>
    <script type="text/javascript">
      const { ipcRenderer } = require('electron');

      function changeBorderRadius(size) {
        document.documentElement.style.setProperty('--px-radius', size + 'px');
      }

      function loadBorderRadius() {
        var fs = require("fs");
        var ppath = require('persist-path')('ArrowBrowser');

        try {
          var borderRadius = fs.readFileSync(ppath + "\\json\\radius.json");
          changeBorderRadius(borderRadius);

          var radios = document.getElementsByName("border-radius");
          for(var i = 0; i < radios.length; i++) {
            if(radios[i].value == borderRadius) {
              radios[i].checked = true;
            }
          }
        } catch (e) {

        }
      }

      function loadAbout() {
        document.getElementById('about-electron').innerHTML = "Electron: v" + process.versions.electron;
        document.getElementById('about-chrome').innerHTML = "Chrome: v" + process.versions.chrome;
        document.getElementById('about-node').innerHTML = "Node: " + process.version;

        ipcRenderer.send('request-set-about');
      }

      function changeTheme(color) {
        document.body.style.backgroundColor = color;

        if(checkIfDark(color)) {
          setIconsStyle('light');

          document.documentElement.style.setProperty('--color-top', 'white');
          document.documentElement.style.setProperty('--color-over', 'rgba(0, 0, 0, 0.2)');
        } else {
          setIconsStyle('dark');

          document.documentElement.style.setProperty('--color-top', 'black');
          document.documentElement.style.setProperty('--color-over', 'rgba(0, 0, 0, 0.1)');
        }
      }

      function setIconsStyle(str) {
        var icons = document.getElementsByClassName('theme-icon');

        for(var i = 0; i < icons.length; i++) {
          icons[i].src = "../themes/" + str + "/icons/" + icons[i].name + ".png";
        }
      }

      function checkIfDark(color) {
          var r, g, b, hsp;
          if (String(color).match(/^rgb/)) {
              color = String(color).match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/);

              r = color[1];
              g = color[2];
              b = color[3];
          } else {
              color = +("0x" + color.slice(1).replace(
              color.length < 5 && /./g, '$&$&'));

              r = color >> 16;
              g = color >> 8 & 255;
              b = color & 255;
          }

          hsp = Math.sqrt(0.299 * (r * r) + 0.587 * (g * g) + 0.114 * (b * b));

          if (hsp > 127.5) {
              return false;
          } else {
              return true;
          }
      }

      function loadTheme() {
        var fs = require("fs");
        var ppath = require('persist-path')('ArrowBrowser');

        try {
          var themeColor = fs.readFileSync(ppath + "\\json\\theme.json");
          changeTheme(themeColor);
        } catch (e) {

        }
      }

      function openDeveloperPage() {
        window.open("https://moduleart.github.io", '_blank');
      }

      function openAppPage() {
        window.open("https://moduleart.github.io/arrowbrowser", '_blank');
      }

      function openReleasesPage() {
        window.open("https://github.com/ModuleArt/arrowbrowser/releases", '_blank');
      }

      function checkForUpdates() {
        ipcRenderer.send('request-check-for-updates');
      }

/*
          ██ ██████   ██████     ██████  ███████ ███    ██ ██████  ███████ ██████  ███████ ██████
          ██ ██   ██ ██          ██   ██ ██      ████   ██ ██   ██ ██      ██   ██ ██      ██   ██
          ██ ██████  ██          ██████  █████   ██ ██  ██ ██   ██ █████   ██████  █████   ██████
          ██ ██      ██          ██   ██ ██      ██  ██ ██ ██   ██ ██      ██   ██ ██      ██   ██
          ██ ██       ██████     ██   ██ ███████ ██   ████ ██████  ███████ ██   ██ ███████ ██   ██
*/

      ipcRenderer.on('action-set-about', (event, arg) => {
        document.getElementById('about-app').innerHTML = "v" + arg.app;
      });

/*
          ██ ███    ██ ██ ████████
          ██ ████   ██ ██    ██
          ██ ██ ██  ██ ██    ██
          ██ ██  ██ ██ ██    ██
          ██ ██   ████ ██    ██
*/

      function init() {
        loadTheme();
        loadAbout();
        loadBorderRadius();
      }

      document.onreadystatechange =  () => {
        if (document.readyState == "complete") {
          init();
        }
      };
    </script>
  </body>
</html>
